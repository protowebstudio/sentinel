---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import HeroMonitoring from "../components/monitoring/HeroMonitoring.astro";
import MonitoringStatus from "../components/monitoring/MonitoringStatus.astro";
import ArchitectureOverview from "../components/monitoring/ArchitectureOverview.astro";
import SecurityControls from "../components/monitoring/SecurityControls.astro";

const HEALTH_URL = "https://api.protowebstudio.com/api/health";

let status: "active" | "inactive" = "inactive";
let lastCheckedAt: string | null = null;

try {
  const response = await fetch(HEALTH_URL, { headers: { Accept: "application/json" } });

  if (response.ok) {
    const data = await response.json();
    if (data && typeof data.status === "string" && typeof data.timestamp === "string") {
      status = data.status === "ok" ? "active" : "inactive";
      lastCheckedAt = data.timestamp;
    }
  }
} catch {
  status = "inactive";
}
---

<BaseLayout title="Sentinel">
  <Header />

  <main id="main-content">
    <HeroMonitoring
      title="Sentinel â€” Institutional Demonstration Surface"
      subtitle="Sentinel is read-only. It validates execution-core availability via a public health probe and presents institutional architecture and security narrative."
      environment="production"
      dashboardUrl="https://www.protowebstudio.com/dashboard"
    />

    <MonitoringStatus
      riskScore={0}
      riskLevel={"low"}
      windowSize={0}
      lastEventAt={lastCheckedAt}
      status={status}
    />

    <ArchitectureOverview />
    <SecurityControls />
  </main>

  <Footer />
</BaseLayout>
